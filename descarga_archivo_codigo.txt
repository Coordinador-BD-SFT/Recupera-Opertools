# views.py
from django.http import FileResponse, Http404
from django.shortcuts import get_object_or_404
from .models import Reporte

def download_file(request, reporte_id, file_type):
    # Obtén la instancia del modelo Reporte usando el ID
    reporte = get_object_or_404(Reporte, id=reporte_id)

    # Elige el archivo basado en el tipo de archivo
    if file_type == 'chats':
        file = reporte.chats_file
    elif file_type == 'envio_sms':
        file = reporte.envio_sms_file
    else:
        raise Http404("Tipo de archivo no válido")

    # Verifica que el archivo exista
    if not file:
        raise Http404("Archivo no encontrado")

    # Sirve el archivo
    response = FileResponse(file.open('rb'), as_attachment=True, filename=file.name)
    return response
